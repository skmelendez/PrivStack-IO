<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:PrivStack.Desktop.ViewModels"
             xmlns:controls="using:PrivStack.Desktop.Controls"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d" d:DesignWidth="440" d:DesignHeight="320"
             x:Class="PrivStack.Desktop.Views.GitHubDeviceFlowDialog"
             x:DataType="vm:ConnectionsViewModel"
             IsVisible="{Binding IsDeviceFlowModalOpen}">

    <!-- Full-screen backdrop -->
    <Panel>
        <Border Classes="modal-backdrop"
                PointerPressed="OnBackdropPressed"/>

        <!-- Centered dialog -->
        <Border HorizontalAlignment="Center"
                VerticalAlignment="Center"
                Width="420"
                Background="{DynamicResource ThemeSurfaceBrush}"
                BorderBrush="{DynamicResource ThemeBorderBrush}"
                BorderThickness="1"
                CornerRadius="12"
                Classes="modal"
                ClipToBounds="True"
                Padding="28,24">
            <StackPanel Spacing="20">

                <!-- Header -->
                <StackPanel Spacing="4">
                    <TextBlock Text="Connect GitHub"
                               FontSize="{DynamicResource ThemeFontSizeLg}"
                               FontWeight="SemiBold"
                               HorizontalAlignment="Center"/>
                    <TextBlock Text="Enter this code on GitHub to authorize PrivStack"
                               FontSize="{DynamicResource ThemeFontSizeSm}"
                               Foreground="{DynamicResource ThemeTextMutedBrush}"
                               HorizontalAlignment="Center"
                               TextAlignment="Center"/>
                </StackPanel>

                <!-- Device Code Display -->
                <Border Background="{DynamicResource ThemePrimaryMutedBrush}"
                        CornerRadius="10" Padding="20,16"
                        HorizontalAlignment="Center">
                    <TextBlock Text="{Binding DeviceUserCode}"
                               FontSize="28"
                               FontWeight="Bold"
                               FontFamily="{DynamicResource ThemeFontMono}"
                               HorizontalAlignment="Center"
                               LetterSpacing="4"/>
                </Border>

                <!-- Action Buttons -->
                <StackPanel Orientation="Horizontal" Spacing="10"
                            HorizontalAlignment="Center">
                    <Button Command="{Binding OpenVerificationUriCommand}"
                            Padding="16,8"
                            Background="{DynamicResource ThemePrimaryBrush}"
                            Foreground="{DynamicResource ThemeTextOnAccentBrush}"
                            CornerRadius="6">
                        <StackPanel Orientation="Horizontal" Spacing="6">
                            <controls:IconControl Icon="ExternalLink" Size="14" StrokeThickness="1.5"
                                                  Stroke="{DynamicResource ThemeTextOnAccentBrush}"/>
                            <TextBlock Text="Open GitHub"
                                       FontSize="{DynamicResource ThemeFontSizeSm}"/>
                        </StackPanel>
                    </Button>

                    <Button x:Name="CopyButton"
                            Click="OnCopyClicked"
                            Padding="16,8"
                            Background="{DynamicResource ThemeSurfaceElevatedBrush}"
                            CornerRadius="6">
                        <StackPanel Orientation="Horizontal" Spacing="6">
                            <controls:IconControl x:Name="CopyIcon"
                                                  Icon="Copy" Size="14" StrokeThickness="1.5"
                                                  Stroke="{DynamicResource ThemeTextPrimaryBrush}"/>
                            <TextBlock x:Name="CopyText"
                                       Text="Copy"
                                       FontSize="{DynamicResource ThemeFontSizeSm}"/>
                        </StackPanel>
                    </Button>

                    <Button Content="Cancel"
                            Command="{Binding CancelConnectCommand}"
                            Padding="16,8"
                            CornerRadius="6"/>
                </StackPanel>

                <!-- Waiting indicator -->
                <StackPanel Orientation="Horizontal" Spacing="8"
                            HorizontalAlignment="Center">
                    <ProgressBar IsIndeterminate="True" Width="80" Height="4"/>
                    <TextBlock Text="Waiting for authorization..."
                               FontSize="{DynamicResource ThemeFontSizeXs}"
                               Foreground="{DynamicResource ThemeTextMutedBrush}"
                               VerticalAlignment="Center"/>
                </StackPanel>

            </StackPanel>
        </Border>
    </Panel>
</UserControl>
