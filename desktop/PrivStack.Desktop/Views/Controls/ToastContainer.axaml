<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:services="using:PrivStack.Desktop.Services"
             xmlns:controls="using:PrivStack.Desktop.Controls"
             x:Class="PrivStack.Desktop.Views.Controls.ToastContainer"
             x:DataType="services:ToastService"
             IsHitTestVisible="True">

    <UserControl.Styles>
        <!-- Toast card entrance animation -->
        <Style Selector="Border.toast-card">
            <Setter Property="RenderTransform" Value="translate(0px, -12px)"/>
            <Setter Property="Opacity" Value="0"/>
            <Setter Property="Transitions">
                <Transitions>
                    <DoubleTransition Property="Opacity" Duration="0:0:0.25" Easing="CubicEaseOut"/>
                    <TransformOperationsTransition Property="RenderTransform" Duration="0:0:0.25" Easing="CubicEaseOut"/>
                </Transitions>
            </Setter>
        </Style>
        <Style Selector="Border.toast-card.visible">
            <Setter Property="RenderTransform" Value="translate(0px, 0px)"/>
            <Setter Property="Opacity" Value="1"/>
        </Style>

        <!-- Dismiss button hover -->
        <Style Selector="Button.toast-dismiss:pointerover /template/ ContentPresenter">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Opacity" Value="1"/>
        </Style>
        <Style Selector="Button.toast-dismiss">
            <Setter Property="Opacity" Value="0.6"/>
        </Style>

        <!-- Action button hover -->
        <Style Selector="Button.toast-action:pointerover /template/ ContentPresenter">
            <Setter Property="Background" Value="{DynamicResource ThemeHoverBrush}"/>
        </Style>

        <!-- Type-specific left accent border colors -->
        <Style Selector="Border.toast-success Border.toast-accent">
            <Setter Property="Background" Value="{DynamicResource ThemeSuccessBrush}"/>
        </Style>
        <Style Selector="Border.toast-info Border.toast-accent">
            <Setter Property="Background" Value="{DynamicResource ThemeInfoBrush}"/>
        </Style>
        <Style Selector="Border.toast-warning Border.toast-accent">
            <Setter Property="Background" Value="{DynamicResource ThemeWarningBrush}"/>
        </Style>
        <Style Selector="Border.toast-error Border.toast-accent">
            <Setter Property="Background" Value="{DynamicResource ThemeDangerBrush}"/>
        </Style>
    </UserControl.Styles>

    <ItemsControl ItemsSource="{Binding Toasts}" MaxWidth="480" MinWidth="320">
        <ItemsControl.ItemsPanel>
            <ItemsPanelTemplate>
                <StackPanel Spacing="8"/>
            </ItemsPanelTemplate>
        </ItemsControl.ItemsPanel>
        <ItemsControl.ItemTemplate>
            <DataTemplate x:DataType="services:ActiveToast">
                <Border Classes="toast-card visible"
                        Background="{DynamicResource ThemeSurfaceElevatedBrush}"
                        BorderBrush="{DynamicResource ThemeBorderBrush}"
                        BorderThickness="1"
                        CornerRadius="8"
                        BoxShadow="0 4 20 0 #40000000"
                        ClipToBounds="True"
                        Tag="{Binding TypeClass}">

                    <Grid ColumnDefinitions="Auto,Auto,*,Auto,Auto">
                        <!-- Colored left accent strip -->
                        <Border Grid.Column="0" Classes="toast-accent"
                                Width="4" CornerRadius="8,0,0,8"
                                Margin="-1,-1,0,-1"/>

                        <!-- Type icon â€” stroke-based via IconControl -->
                        <Panel Grid.Column="1" Width="16" Height="16"
                               VerticalAlignment="Top" Margin="12,12,10,0">
                            <controls:IconControl Icon="Check"
                                                  Size="16" StrokeThickness="2"
                                                  Stroke="{DynamicResource ThemeSuccessBrush}"
                                                  IsVisible="{Binding IsSuccess}"/>
                            <controls:IconControl Icon="Info"
                                                  Size="16" StrokeThickness="2"
                                                  Stroke="{DynamicResource ThemeInfoBrush}"
                                                  IsVisible="{Binding IsInfo}"/>
                            <controls:IconControl Icon="AlertCircle"
                                                  Size="16" StrokeThickness="2"
                                                  Stroke="{DynamicResource ThemeWarningBrush}"
                                                  IsVisible="{Binding IsWarning}"/>
                            <controls:IconControl Icon="AlertCircle"
                                                  Size="16" StrokeThickness="2"
                                                  Stroke="{DynamicResource ThemeDangerBrush}"
                                                  IsVisible="{Binding IsError}"/>
                        </Panel>

                        <!-- Label + Message -->
                        <StackPanel Grid.Column="2" Spacing="2"
                                    VerticalAlignment="Center" Margin="0,10,0,10">
                            <TextBlock Text="{Binding FriendlyLabel}"
                                       FontWeight="SemiBold"
                                       FontSize="{DynamicResource ThemeFontSizeSm}"
                                       Foreground="{DynamicResource ThemeTextPrimaryBrush}"/>
                            <TextBlock Text="{Binding Message}"
                                       FontSize="{DynamicResource ThemeFontSizeXsSm}"
                                       Foreground="{DynamicResource ThemeTextSecondaryBrush}"
                                       TextWrapping="Wrap"
                                       MaxWidth="360"/>
                        </StackPanel>

                        <!-- Action button (optional) -->
                        <Button Grid.Column="3"
                                Classes="toast-action"
                                Content="{Binding ActionLabel}"
                                IsVisible="{Binding ActionLabel, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"
                                Background="Transparent"
                                BorderThickness="1"
                                BorderBrush="{DynamicResource ThemeBorderBrush}"
                                CornerRadius="4"
                                Padding="8,4"
                                Margin="8,0,0,0"
                                FontSize="{DynamicResource ThemeFontSizeXsSm}"
                                Foreground="{DynamicResource ThemeTextPrimaryBrush}"
                                VerticalAlignment="Center"
                                Cursor="Hand"
                                Click="OnActionClick"/>

                        <!-- Dismiss button -->
                        <Button Grid.Column="4"
                                Classes="toast-dismiss"
                                Background="Transparent"
                                BorderThickness="0"
                                Padding="4"
                                Margin="6,0,8,0"
                                MinHeight="0" MinWidth="0"
                                VerticalAlignment="Top"
                                Cursor="Hand"
                                Click="OnDismissClick">
                            <controls:IconControl Icon="X"
                                                  Size="12" StrokeThickness="1.5"
                                                  Stroke="{DynamicResource ThemeTextMutedBrush}"/>
                        </Button>
                    </Grid>
                </Border>
            </DataTemplate>
        </ItemsControl.ItemTemplate>
    </ItemsControl>
</UserControl>
