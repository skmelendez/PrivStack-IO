<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:services="using:PrivStack.Desktop.Services"
             x:Class="PrivStack.Desktop.Views.Controls.ToastContainer"
             x:DataType="services:ToastService"
             IsHitTestVisible="True">

    <UserControl.Styles>
        <!-- Toast card entrance animation -->
        <Style Selector="Border.toast-card">
            <Setter Property="RenderTransform" Value="translate(0px, -12px)"/>
            <Setter Property="Opacity" Value="0"/>
            <Setter Property="Transitions">
                <Transitions>
                    <DoubleTransition Property="Opacity" Duration="0:0:0.25" Easing="CubicEaseOut"/>
                    <TransformOperationsTransition Property="RenderTransform" Duration="0:0:0.25" Easing="CubicEaseOut"/>
                </Transitions>
            </Setter>
        </Style>
        <Style Selector="Border.toast-card.visible">
            <Setter Property="RenderTransform" Value="translate(0px, 0px)"/>
            <Setter Property="Opacity" Value="1"/>
        </Style>

        <!-- Dismiss button hover -->
        <Style Selector="Button.toast-dismiss:pointerover /template/ ContentPresenter">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Opacity" Value="1"/>
        </Style>
        <Style Selector="Button.toast-dismiss">
            <Setter Property="Opacity" Value="0.6"/>
        </Style>

        <!-- Action button hover -->
        <Style Selector="Button.toast-action:pointerover /template/ ContentPresenter">
            <Setter Property="Background" Value="{DynamicResource ThemeHoverBrush}"/>
        </Style>

        <!-- Type-specific toast card backgrounds and borders -->
        <Style Selector="Border.toast-success">
            <Setter Property="Background" Value="{DynamicResource ThemeSuccessMutedBrush}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource ThemeSuccessBrush}"/>
        </Style>
        <Style Selector="Border.toast-info">
            <Setter Property="Background" Value="{DynamicResource ThemeInfoMutedBrush}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource ThemeInfoBrush}"/>
        </Style>
        <Style Selector="Border.toast-warning">
            <Setter Property="Background" Value="{DynamicResource ThemeWarningMutedBrush}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource ThemeWarningBrush}"/>
        </Style>
        <Style Selector="Border.toast-error">
            <Setter Property="Background" Value="{DynamicResource ThemeDangerMutedBrush}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource ThemeDangerBrush}"/>
        </Style>

        <!-- Type-specific icon colors -->
        <Style Selector="PathIcon.icon-success">
            <Setter Property="Foreground" Value="{DynamicResource ThemeSuccessBrush}"/>
        </Style>
        <Style Selector="PathIcon.icon-info">
            <Setter Property="Foreground" Value="{DynamicResource ThemeInfoBrush}"/>
        </Style>
        <Style Selector="PathIcon.icon-warning">
            <Setter Property="Foreground" Value="{DynamicResource ThemeWarningBrush}"/>
        </Style>
        <Style Selector="PathIcon.icon-error">
            <Setter Property="Foreground" Value="{DynamicResource ThemeDangerBrush}"/>
        </Style>
    </UserControl.Styles>

    <ItemsControl ItemsSource="{Binding Toasts}" MaxWidth="480" MinWidth="320">
        <ItemsControl.ItemsPanel>
            <ItemsPanelTemplate>
                <StackPanel Spacing="8"/>
            </ItemsPanelTemplate>
        </ItemsControl.ItemsPanel>
        <ItemsControl.ItemTemplate>
            <DataTemplate x:DataType="services:ActiveToast">
                <Border Classes="toast-card visible"
                        BorderThickness="1"
                        CornerRadius="8"
                        Padding="14,10"
                        BoxShadow="0 4 16 0 #30000000"
                        ClipToBounds="True"
                        Tag="{Binding TypeClass}">

                    <Grid ColumnDefinitions="Auto,*,Auto,Auto">
                        <!-- Type icon â€” one per type, toggled via IsVisible -->
                        <Panel Grid.Column="0" Width="16" Height="16" VerticalAlignment="Top" Margin="0,2,10,0">
                            <PathIcon Data="M20 6L9 17l-5-5"
                                      Classes="icon-success"
                                      Width="16" Height="16"
                                      IsVisible="{Binding IsSuccess}"/>
                            <PathIcon Data="M12 2a10 10 0 1 0 0 20 10 10 0 0 0 0-20z M12 16v-4 M12 8h.01"
                                      Classes="icon-info"
                                      Width="16" Height="16"
                                      IsVisible="{Binding IsInfo}"/>
                            <PathIcon Data="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z M12 9v4 M12 17h.01"
                                      Classes="icon-warning"
                                      Width="16" Height="16"
                                      IsVisible="{Binding IsWarning}"/>
                            <PathIcon Data="M12 2a10 10 0 1 0 0 20 10 10 0 0 0 0-20z M12 8v4 M12 16h.01"
                                      Classes="icon-error"
                                      Width="16" Height="16"
                                      IsVisible="{Binding IsError}"/>
                        </Panel>

                        <!-- Label + Message -->
                        <StackPanel Grid.Column="1" Spacing="2" VerticalAlignment="Center">
                            <TextBlock Text="{Binding FriendlyLabel}"
                                       FontWeight="SemiBold"
                                       FontSize="{DynamicResource ThemeFontSizeSm}"
                                       Foreground="{DynamicResource ThemeTextPrimaryBrush}"/>
                            <TextBlock Text="{Binding Message}"
                                       FontSize="{DynamicResource ThemeFontSizeXsSm}"
                                       Foreground="{DynamicResource ThemeTextSecondaryBrush}"
                                       TextWrapping="Wrap"
                                       MaxWidth="360"/>
                        </StackPanel>

                        <!-- Action button (optional) -->
                        <Button Grid.Column="2"
                                Classes="toast-action"
                                Content="{Binding ActionLabel}"
                                IsVisible="{Binding ActionLabel, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"
                                Background="Transparent"
                                BorderThickness="1"
                                BorderBrush="{DynamicResource ThemeBorderBrush}"
                                CornerRadius="4"
                                Padding="8,4"
                                Margin="8,0,0,0"
                                FontSize="{DynamicResource ThemeFontSizeXsSm}"
                                Foreground="{DynamicResource ThemeTextPrimaryBrush}"
                                VerticalAlignment="Center"
                                Cursor="Hand"
                                Click="OnActionClick"/>

                        <!-- Dismiss button -->
                        <Button Grid.Column="3"
                                Classes="toast-dismiss"
                                Background="Transparent"
                                BorderThickness="0"
                                Padding="4"
                                Margin="6,0,0,0"
                                MinHeight="0" MinWidth="0"
                                VerticalAlignment="Top"
                                Cursor="Hand"
                                Click="OnDismissClick">
                            <PathIcon Data="M18 6L6 18 M6 6l12 12"
                                      Width="12" Height="12"
                                      Foreground="{DynamicResource ThemeTextMutedBrush}"/>
                        </Button>
                    </Grid>
                </Border>
            </DataTemplate>
        </ItemsControl.ItemTemplate>
    </ItemsControl>
</UserControl>
